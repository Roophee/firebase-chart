(this.webpackJsonpchat_firebase=this.webpackJsonpchat_firebase||[]).push([[4],{316:function(e,t,a){"use strict";a.r(t);var n=a(1),i=a(315),r=a(292),o=a(291),s=a(17),c=a(13),l=a(296),u=a(36),d=a(23),g=a(14),m=function(e){var t=g.a.getDB,a=g.a.getDialogPath;t&&Object(d.a)(Object(d.b)(t,a),e)},h=function(){var e,t=g.a.getCurrentUser(),a=null===t||void 0===t?void 0:t.uid,n=g.a.getCurrentOpponent,i=null===(e=g.a.getCurrentOpponent)||void 0===e?void 0:e.id,r=g.a.getDB;if(t&&r&&n){var o=Object(d.b)(r,"dialogs"),s=Object(d.g)(o,Object(d.i)("members","array-contains",a));Object(d.d)(s).then((function(e){var t=e.docs.filter((function(e){return e.data().members.includes(i)}));t.length<1&&function(e,t,a){Object(d.a)(Object(d.b)(e,"dialogs"),{members:[t,a]}).then((function(e){g.a.setDialogPath(e.path.split("/")[1]);var t={author:"root",message:"".concat(g.a.getUsersInfo.name?g.a.getUsersInfo.name:"You"," started the dialog"),time:Date.now()};m(t)}))}(r,a,null===n||void 0===n?void 0:n.id),t.length>0&&g.a.setDialogPath(t[0].id)}))}},b=a(6),f=Object(o.a)((function(){return{userListItem:{display:"flex",alignItems:"center",width:"90%",height:"70px",marginBottom:"5px",paddingLeft:"5px",backgroundColor:"#263238",borderRadius:"10px",color:"#fff"},imageBox:{width:"50px",height:"50px",minWidth:"50px",borderRadius:"50%",overflow:"hidden",marginRight:"20px","& img":{width:"50px",height:"50px"}}}})),x=Object(u.a)((function(e){var t=e.user,a=t.name,n=t.photoUrl,i=f();return Object(b.jsxs)(r.a,{className:i.userListItem,onClick:function(){var t=g.a.getUnsubscribeDialog;t&&t(),g.a.setCurrentOpponent(e.user),h()},children:[Object(b.jsx)(r.a,{className:i.imageBox,children:Object(b.jsx)("img",{src:n||"https://eu.ui-avatars.com/api/?background=0D8ABC&color=fff&name=".concat(a.split(" ").join("+")),alt:"user_photo"})}),Object(b.jsx)(r.a,{children:a})]})})),j=Object(o.a)({usersList:{width:"100%",height:"80%",padding:" 0 5px",overflow:"overlay"}}),p=Object(u.a)((function(){var e=g.a.getCurrentUser(),t=Object(n.useState)(!1),a=Object(c.a)(t,2),i=a[0],o=a[1],u=Object(n.useState)([]),m=Object(c.a)(u,2),h=m[0],f=m[1],p=j(),O=g.a.getDB;return Object(n.useEffect)((function(){if(O){o(!0);var t=Object(d.g)(Object(d.b)(O,"users"));Object(d.f)(t,(function(t){var a=[];t.forEach((function(t){e&&e.uid!==t.data().id&&a.push(t.data())})),f(Object(s.a)(a.sort((function(e,t){return Number(t.lastActivity)-Number(e.lastActivity)})))),o(!1)}))}}),[O,e]),i?Object(b.jsx)(b.Fragment,{children:"loading..."}):Object(b.jsx)(r.a,{className:p.usersList,children:Object(b.jsx)(l.Scrollbars,{className:p.usersList,children:h.map((function(e){return Object(b.jsx)(x,{user:e},e.name)}))})})})),O={hour:"numeric",minute:"2-digit",second:"2-digit"},v={weekday:"short",hour:"numeric",minute:"2-digit"},D=function(e,t){return new Date(e).toLocaleTimeString("en-GB",t)},w=function(e){return[1,30,29].includes(Math.abs(Number((new Date).getDate())-Number(new Date(e).getDate())))?"yesterday":Number((new Date).getDate())-Number(new Date(e).getDate())===0?"today":""},N=Object(o.a)((function(){return{messageContainer:{display:"flex",maxWidth:"80%"},messageItem:{display:"flex",flexDirection:"column",width:"max-content",marginBottom:"5px",padding:"10px",borderRadius:"10px",color:"#fff"},name:{fontWeight:600},message:{color:"#EEEEEE"},imageBox:{width:"50px",height:"50px",minWidth:"50px",borderRadius:"50%",overflow:"hidden",marginRight:"20px","& img":{width:"50px",height:"50px"}}}})),y=Object(u.a)((function(e){var t,a=e.message,n=g.a.getCurrentOpponent,i=N();return Object(b.jsxs)(r.a,{className:i.messageContainer,alignSelf:a.author===g.a.getUsersInfo.name?"flex-end":"root"===a.author?"center":"",children:[a.author===(null===n||void 0===n?void 0:n.name)&&Object(b.jsx)(r.a,{className:i.imageBox,children:Object(b.jsx)("img",{src:(null===n||void 0===n?void 0:n.photoUrl)?n.photoUrl:"https://eu.ui-avatars.com/api/?background=0D8ABC&color=fff&name=".concat(null===n||void 0===n?void 0:n.name.split(" ").join("+")),alt:"user_photo"})}),Object(b.jsxs)(r.a,{bgcolor:a.author===g.a.getUsersInfo.name?"#263238":"#37474F",className:i.messageItem,children:[Object(b.jsx)(r.a,{className:i.name,children:"root"===a.author?"":a.author}),Object(b.jsx)(r.a,{className:i.message,children:a.message}),Object(b.jsx)(r.a,{alignSelf:"flex-end",color:"#BDBDBD",children:(t=a.time,Number((new Date).getDate())-Number(new Date(t).getDate())===0?"".concat(w(t)," ").concat(D(t,O)):"".concat(w(t)," ").concat(D(t,v)))})]})]})})),B=a(26),C=Object(o.a)({messageForm:{display:"flex",flexDirection:"column",marginBottom:"10px","& textarea":{width:"100%",height:"100px",margin:"0 0 5px 0",padding:"5px",borderRadius:"10px",resize:"none",fontFamily:"default"},"& button":{width:"150px",height:"40px",alignSelf:"flex-end",borderRadius:"10px",backgroundColor:"#09B83E","&:hover":{backgroundColor:"#099336"}}},sendMessage:{},messagesPanel:{display:"flex",flexDirection:"column",flexGrow:1}}),E=Object(u.a)((function(){var e=C(),t=function(e){if(e){var t={author:Object(B.h)(g.a.getUsersInfo).name,message:e,time:Date.now()};m(t)}};return Object(b.jsx)(r.a,{className:e.sendMessage,children:Object(b.jsxs)("form",{className:e.messageForm,onSubmit:function(e){e.preventDefault();var a=e.target.elements[0];a&&(t(a.value.trim()),a.value="")},children:[Object(b.jsx)("textarea",{onKeyDown:function(e){if("Enter"===e.code){e.preventDefault();var a=e.target;t(a.value.trim()),a.value=""}},disabled:!g.a.dialog.length,name:"text",id:"text",maxLength:500,placeholder:" Message..."}),Object(b.jsx)("button",{type:"submit",disabled:!g.a.dialog.length,children:"Send"})]})})})),R=Object(o.a)({personalChat:{width:"100%",height:"100%",display:"flex",flexDirection:"column",paddingLeft:"10px"},messageForm:{display:"flex",flexDirection:"column","& textarea":{width:"100%",height:"100px",margin:"0 0 5px 0",padding:"5px",borderRadius:"10px",resize:"none",fontFamily:"default"},"& button":{width:"150px",height:"40px",alignSelf:"flex-end",borderRadius:"10px",backgroundColor:"#09B83E","&:hover":{backgroundColor:"#099336"}}},sendMessage:{},messagesPanel:{display:"flex",flexDirection:"column",overflow:"overlay",flexGrow:1,paddingRight:"20px"}}),S=Object(u.a)((function(){var e=g.a.getDialog,t=g.a.getDialogPath,a=R(),i=Object(n.useRef)(null);return Object(n.useEffect)((function(){var e=g.a.getDB,t=g.a.getDialogPath;e&&t&&function(e,t){var a=Object(d.g)(Object(d.b)(e,t)),n=Object(d.f)(a,(function(e){var t=[];e.forEach((function(e){t.push(e.data()),t.sort((function(e,t){return e.time-t.time})),g.a.setDialog(t)}))}));g.a.setUnsubscribeDialog(n)}(e,t)}),[t]),Object(n.useEffect)((function(){i.current&&i.current&&i.current.scrollToBottom()}),[e]),Object(b.jsxs)(r.a,{className:a.personalChat,children:[Object(b.jsx)(l.Scrollbars,{ref:i,autoHide:!0,autoHideTimeout:1e3,autoHideDuration:200,children:Object(b.jsx)("div",{className:a.messagesPanel,children:e.length>0?e.map((function(e){return Object(b.jsx)(y,{message:e},e.time)})):Object(b.jsx)("div",{style:{alignSelf:"center"},children:"Choose the dialog with someone"})})}),Object(b.jsx)(r.a,{className:a.sendMessage,children:Object(b.jsx)(E,{})})]})})),U=Object(o.a)({bbox:{height:"94%"},outerGrid:{height:"100%"},innerGrid:{height:"100%",overflow:"layout"}});t.default=function(){var e=U();return Object(b.jsx)(r.a,{className:e.bbox,children:Object(b.jsxs)(i.a,{container:!0,className:e.outerGrid,children:[Object(b.jsx)(i.a,{className:e.innerGrid,item:!0,xs:3,children:Object(b.jsx)(p,{})}),Object(b.jsx)(i.a,{item:!0,xs:9,className:e.innerGrid,children:Object(b.jsx)(S,{})})]})})}}}]);
//# sourceMappingURL=4.c0366177.chunk.js.map